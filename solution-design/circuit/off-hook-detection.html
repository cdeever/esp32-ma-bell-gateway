

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Off-Hook Detection &mdash; ESP32 Ma Bell Gateway 1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=edc13519" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=f2a433a1"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Ringer Signaling" href="ringer.html" />
    <link rel="prev" title="Power Supplies" href="power.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            ESP32 Ma Bell Gateway
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../standards.html">Telephone Service Standards</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../solution-design.html">Solution Design</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../esp32-microcontroller.html">ESP32 Microcontroller</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Circuit Design</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="power.html">Power Supplies</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Off-Hook Detection</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#system-behavior">System Behavior</a></li>
<li class="toctree-l4"><a class="reference internal" href="#electrical-detection-principle">Electrical Detection Principle</a></li>
<li class="toctree-l4"><a class="reference internal" href="#historical-framing">Historical Framing</a></li>
<li class="toctree-l4"><a class="reference internal" href="#detection-approach-options">Detection Approach Options</a></li>
<li class="toctree-l4"><a class="reference internal" href="#behavior-performance">Behavior &amp; Performance</a></li>
<li class="toctree-l4"><a class="reference internal" href="#safety-power-integration">Safety, Power &amp; Integration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#complexity-cost-final-score">Complexity, Cost &amp; Final Score</a></li>
<li class="toctree-l4"><a class="reference internal" href="#best-choice-based-on-score">Best Choice Based on Score</a></li>
<li class="toctree-l4"><a class="reference internal" href="#debouncing-and-safety">Debouncing and Safety</a></li>
<li class="toctree-l4"><a class="reference internal" href="#signal-flow-overview">Signal Flow Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="#final-thoughts">Final Thoughts</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="ringer.html">Ringer Signaling</a></li>
<li class="toctree-l3"><a class="reference internal" href="audio.html">Voice and Tone Audio</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../software/index.html">Software Design</a></li>
<li class="toctree-l2"><a class="reference internal" href="../enclosure/index.html">Enclosure Design</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../usage.html">Usage</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">ESP32 Ma Bell Gateway</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../solution-design.html">Solution Design</a></li>
          <li class="breadcrumb-item"><a href="index.html">Circuit Design</a></li>
      <li class="breadcrumb-item active">Off-Hook Detection</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/solution-design/circuit/off-hook-detection.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="off-hook-detection">
<h1>Off-Hook Detection<a class="headerlink" href="#off-hook-detection" title="Link to this heading"></a></h1>
<p>An <strong>off-hook detection circuit</strong> is required to sense when a telephone receiver is lifted—completing the subscriber loop between tip and ring—so that the system can recognize an attempt to place or answer a call.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>Safety:</strong> The subscriber loop may carry up to 48V DC and 90V AC ringing. All detection methods must provide robust isolation to protect the ESP32 and the user. Never connect microcontroller logic directly to line voltage.</p>
</div>
<section id="system-behavior">
<h2>System Behavior<a class="headerlink" href="#system-behavior" title="Link to this heading"></a></h2>
<p>When the phone goes <strong>off-hook</strong> (receiver lifted), the Ma Bell Gateway:</p>
<ul class="simple">
<li><p>Senses the closed loop and increased current via the off-hook detection circuit</p></li>
<li><p>Activates dial illumination</p></li>
<li><p>Starts dial tone generation</p></li>
<li><p>Prepares the Bluetooth subsystem for call placement or to answer incoming calls</p></li>
</ul>
<p>When the phone returns <strong>on-hook</strong> (receiver replaced), the system:</p>
<ul class="simple">
<li><p>Stops dial illumination and dial tone</p></li>
<li><p>Ends or cancels any active Bluetooth call or call setup</p></li>
</ul>
</section>
<section id="electrical-detection-principle">
<h2>Electrical Detection Principle<a class="headerlink" href="#electrical-detection-principle" title="Link to this heading"></a></h2>
<p>Off-hook is detected as a significant increase in loop current (typically 20–60mA), as the subscriber loop is closed by lifting the receiver. The selected detection circuit senses this current or voltage change and provides a safe, isolated logic signal to the ESP32.</p>
</section>
<section id="historical-framing">
<h2>Historical Framing<a class="headerlink" href="#historical-framing" title="Link to this heading"></a></h2>
<p>Telephone systems—whether classic analog or modern digital—have always required reliable methods to detect when a subscriber lifts the receiver (“goes off-hook”). Over time, the technology for sensing this condition has evolved to meet new demands for safety, durability, integration, and compatibility with advancing switching systems. Each stage in this progression reflects broader shifts in both available technology and network requirements.</p>
<ul class="simple">
<li><p><strong>1900s–1940s:</strong> Mechanical relays sensed loop current and physically closed contacts to engage switching equipment.</p></li>
<li><p><strong>1950s–1970s:</strong> Solid-state transistor circuits began replacing relays in central office and PBX gear.</p></li>
<li><p><strong>1970s–1990s:</strong> Optocouplers introduced safe isolation between analog lines and digital switching logic.</p></li>
<li><p><strong>2000s–present:</strong> Solid-state relays (SSRs) and line interface ICs became common in VoIP and embedded systems.</p></li>
</ul>
</section>
<section id="detection-approach-options">
<h2>Detection Approach Options<a class="headerlink" href="#detection-approach-options" title="Link to this heading"></a></h2>
<p>Several hardware approaches were considered for off-hook detection. Each method reflects a different era or technology, with distinct advantages and drawbacks:</p>
<ul class="simple">
<li><p><strong>Mechanical Relay:</strong>
The classic approach—uses a relay coil in series with the phone line. When the handset is lifted, loop current flows, energizing the coil and closing relay contacts. This method provides satisfying audible/physical feedback (“click”), but relays are bulky, slow, and eventually wear out due to mechanical contacts.</p></li>
<li><p><strong>Resistor + Transistor:</strong>
An early solid-state solution—places a current-sensing resistor in the line. When enough current flows, it creates a voltage drop that turns on a transistor, which then signals the logic input. Simple and cheap, but offers no isolation and exposes sensitive electronics to high voltages.</p></li>
<li><p><strong>Optocoupler:</strong>
The modern, best-practice method. The loop current drives an LED inside the optocoupler, which activates an isolated phototransistor connected to the ESP32. Provides safe galvanic isolation, is compact and reliable, and integrates easily with microcontrollers.</p></li>
<li><p><strong>Solid-State Relay (SSR):</strong>
Uses an internal opto-isolated switch or MOSFET pair. SSRs offer “plug and play” operation, are fully silent, have no moving parts, and provide isolation. They are sometimes more expensive and may leak a small current even when “off.”</p></li>
</ul>
</section>
<section id="behavior-performance">
<h2>Behavior &amp; Performance<a class="headerlink" href="#behavior-performance" title="Link to this heading"></a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 22.4%" />
<col style="width: 19.4%" />
<col style="width: 19.4%" />
<col style="width: 19.4%" />
<col style="width: 19.4%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Feature</strong></p></th>
<th class="head"><p><strong>Mechanical Relay</strong></p></th>
<th class="head"><p><strong>Resistor + Transistor</strong></p></th>
<th class="head"><p><strong>Optocoupler</strong></p></th>
<th class="head"><p><strong>SSR</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>Sound / Feel</strong></p></td>
<td><p>✅ Clunky click</p></td>
<td><p>❌ Silent</p></td>
<td><p>❌ Silent</p></td>
<td><p>❌ Silent</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Speed</strong></p></td>
<td><p>❌ Slower</p></td>
<td><p>✅ Fast</p></td>
<td><p>✅ Fast</p></td>
<td><p>✅ Fast</p></td>
</tr>
<tr class="row-even"><td><p><strong>Wear</strong></p></td>
<td><p>❌ Wears out</p></td>
<td><p>✅ No wear</p></td>
<td><p>✅ No wear</p></td>
<td><p>✅ No wear</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Reliability</strong></p></td>
<td><p>❌ Contact wear</p></td>
<td><p>✅ Stable</p></td>
<td><p>✅ Very stable</p></td>
<td><p>✅ Some leakage</p></td>
</tr>
</tbody>
</table>
</section>
<section id="safety-power-integration">
<h2>Safety, Power &amp; Integration<a class="headerlink" href="#safety-power-integration" title="Link to this heading"></a></h2>
<p>All methods connect to an ESP32 using basic GPIO—no special peripherals needed.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 22.4%" />
<col style="width: 19.4%" />
<col style="width: 19.4%" />
<col style="width: 19.4%" />
<col style="width: 19.4%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Feature</strong></p></th>
<th class="head"><p><strong>Mechanical Relay</strong></p></th>
<th class="head"><p><strong>Resistor + Transistor</strong></p></th>
<th class="head"><p><strong>Optocoupler</strong></p></th>
<th class="head"><p><strong>SSR</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>Voltage Isolation</strong></p></td>
<td><p>✅ Isolated</p></td>
<td><p>❌ Direct risk</p></td>
<td><p>✅ Isolated</p></td>
<td><p>✅ Isolated</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Current Draw</strong></p></td>
<td><p>20–60mA</p></td>
<td><p>20–60mA</p></td>
<td><p>20–60mA</p></td>
<td><p>Very low</p></td>
</tr>
<tr class="row-even"><td><p><strong>Power Needs</strong></p></td>
<td><p>❌ Extra power</p></td>
<td><p>✅ None</p></td>
<td><p>✅ None</p></td>
<td><p>✅ None</p></td>
</tr>
</tbody>
</table>
</section>
<section id="complexity-cost-final-score">
<h2>Complexity, Cost &amp; Final Score<a class="headerlink" href="#complexity-cost-final-score" title="Link to this heading"></a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 22.4%" />
<col style="width: 19.4%" />
<col style="width: 19.4%" />
<col style="width: 19.4%" />
<col style="width: 19.4%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Feature</strong></p></th>
<th class="head"><p><strong>Mechanical Relay</strong></p></th>
<th class="head"><p><strong>Resistor + Transistor</strong></p></th>
<th class="head"><p><strong>Optocoupler</strong></p></th>
<th class="head"><p><strong>SSR</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>Simplicity</strong></p></td>
<td><p>❌ Needs driver</p></td>
<td><p>❌ Needs protection</p></td>
<td><p>✅ Simple</p></td>
<td><p>✅ PnP</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Complexity</strong></p></td>
<td><p>❌ Moderate</p></td>
<td><p>✅ Low</p></td>
<td><p>✅ Low</p></td>
<td><p>✅ Low</p></td>
</tr>
<tr class="row-even"><td><p><strong>Cost</strong></p></td>
<td><p>❌ Moderate</p></td>
<td><p>✅ Cheapest</p></td>
<td><p>✅ Affordable</p></td>
<td><p>❌ Higher</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Pitfalls</strong></p></td>
<td><p>Debounce needed</p></td>
<td><p>Needs Zener</p></td>
<td><p>Vf matching</p></td>
<td><p>Leakage</p></td>
</tr>
<tr class="row-even"><td><p><strong>🔥 Final Score</strong></p></td>
<td><p><strong>34</strong></p></td>
<td><p><strong>27</strong></p></td>
<td><p><strong>45</strong></p></td>
<td><p><strong>42</strong></p></td>
</tr>
</tbody>
</table>
</section>
<section id="best-choice-based-on-score">
<h2>Best Choice Based on Score<a class="headerlink" href="#best-choice-based-on-score" title="Link to this heading"></a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 71.4%" />
<col style="width: 28.6%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Detection Method</strong></p></th>
<th class="head"><p><strong>Final Score (Max 50)</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>✅ <strong>Optocoupler (Modern Isolation)</strong> → <em>Best Overall</em></p></td>
<td><p><strong>45</strong></p></td>
</tr>
<tr class="row-odd"><td><p>✅ <strong>SSR (No Click)</strong> → <em>PnP Option</em></p></td>
<td><p><strong>42</strong></p></td>
</tr>
<tr class="row-even"><td><p>✅ <strong>Mechanical Relay (Clicky CO Feel)</strong></p></td>
<td><p><strong>34</strong></p></td>
</tr>
<tr class="row-odd"><td><p>✅ <strong>Resistor + Transistor (Vintage Style)</strong></p></td>
<td><p><strong>27</strong></p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In modern commercial telephony and VoIP/FXS hardware, optocouplers and line interface ICs are the preferred method for safety, integration, and cost. SSRs are also viable, but may introduce leakage and are less common for low-current analog loops.</p>
</div>
</section>
<section id="debouncing-and-safety">
<h2>Debouncing and Safety<a class="headerlink" href="#debouncing-and-safety" title="Link to this heading"></a></h2>
<p>To ensure reliable operation, the system <strong>needs to implement software debouncing</strong> on the optocoupler signal. This prevents false triggers caused by voltage spikes or rapid toggling. Additionally, a supervisory timeout should be included to detect and respond appropriately if the phone remains off-hook for an extended period (e.g., playing a reorder tone or releasing a call after a timeout).</p>
</section>
<section id="signal-flow-overview">
<h2>Signal Flow Overview<a class="headerlink" href="#signal-flow-overview" title="Link to this heading"></a></h2>
<p>The following diagram illustrates the off-hook detection signal path, from the high-voltage line, through the detection circuit, to the ESP32 microcontroller. This ensures both isolation and accurate sensing of the phone’s status.</p>
<a class="reference internal image-reference" href="../../_images/off_hook_signal_flow.png"><img alt="Off-hook detection signal flow from phone line to ESP32" class="align-center" src="../../_images/off_hook_signal_flow.png" style="width: 400px;" />
</a>
</section>
<section id="final-thoughts">
<h2>Final Thoughts<a class="headerlink" href="#final-thoughts" title="Link to this heading"></a></h2>
<p>In this project, the <strong>optocoupler-based circuit</strong> will be used for off-hook detection. It provides galvanic isolation from the phone line and allows the ESP32 to monitor the line safely.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p><strong>Before connecting to real phone voltages, always validate your optocoupler circuit with a scaled-down (low-voltage) DC source first.</strong> This ensures reliable triggering and confirms isolation, helping protect both you and your hardware.</p>
</div>
<p>The implementation will require:</p>
<blockquote>
<div><ul class="simple">
<li><p>A <strong>current-limiting resistor</strong> on the optocoupler’s input side</p></li>
<li><p>Careful matching of the <strong>forward voltage (Vf)</strong> and current for reliable triggering</p></li>
<li><p>A <strong>pull-up resistor</strong> or logic input to the ESP32 on the output side</p></li>
<li><p>Optional use of a <strong>Schmitt trigger or GPIO interrupt</strong> for clean digital transitions</p></li>
</ul>
</div></blockquote>
<p>This approach reflects how later-generation COs managed line isolation while providing a practical and safe solution for modern embedded design.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="power.html" class="btn btn-neutral float-left" title="Power Supplies" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="ringer.html" class="btn btn-neutral float-right" title="Ringer Signaling" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Chris Deever.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>