Power Implementation (48V Central Supply)
=========================================

Overview
--------

The Ma Bell Gateway system is powered by a single 48V/60W DC supply, with all required operating voltages generated by a combination of DC-DC converters and a ring generator circuit.

Key voltage rails and their uses:

- **-48V** for the subscriber loop (on-hook voltage)
- **12V** for SLIC (HC3-5504B-5) chip primary power
- **5V or 3.3V** for the ESP32 microcontroller and logic
- **90V AC, 20Hz** for authentic telephone ringer operation

Power Architecture
------------------

#.. figure:: /_static/power-architecture.png
#   :alt: Power supply block diagram
#   :align: center

   *(Placeholder: insert PNG/SVG block diagram here)*

::

    +----------------+
    | 48V DC Supply  |
    +-------+--------+
            |
    +-------+--------+-------------------+-------------------+
    |       |        |                   |                   |
    v       v        v                   v                   v
 [12V Buck][5V Buck][Inverting DC-DC][Ring Generator]    (Future Option)
    |        |            |                  |
    v        v            v                  v
 SLIC VCC  ESP32/Logic  SLIC Tip/Ring      Ringer

Step-by-Step Power Flow
-----------------------

1. **48V Supply as Master Power**

   - The central 48V/60W power brick is the main power source.
   - All subsequent rails are derived from this supply.

2. **-48V for On-Hook Loop**

   - An *inverting DC-DC converter* generates a stable -48V rail referenced to ground.
   - Supplies the SLIC's tip/ring pair for line voltage during on-hook state.

3. **12V for SLIC Primary Power**

   - A *DC-DC buck converter* steps 48V down to 12V.
   - Powers the VCC/VDD pins on the HC3-5504B-5 for analog functions.

4. **5V or 3.3V for ESP32 & Logic**

   - Another *buck converter* (or LDO after pre-drop) steps down 48V to 5V or 3.3V.
   - Feeds the ESP32 dev board and any digital logic.

5. **90V AC, 20Hz for Ringer**

   - The 48V supply feeds a *ring generator module* that creates a 90V AC, 20Hz waveform.
   - Used for authentic operation of electromechanical ringers.

Power Rail Table
----------------

+-----------------+--------------+-------------------------+-------------------------------+
| Rail            | Voltage      | Supplies                | How Created                   |
+=================+==============+=========================+===============================+
| Vbat            | +48V DC      | All conversions         | Main supply (60W)             |
+-----------------+--------------+-------------------------+-------------------------------+
| SLIC Loop       | -48V DC      | SLIC (Tip/Ring)         | Inverting DC-DC from 48V      |
+-----------------+--------------+-------------------------+-------------------------------+
| SLIC Power      | +12V DC      | SLIC (VCC)              | Buck converter from 48V       |
+-----------------+--------------+-------------------------+-------------------------------+
| Logic           | +5V / 3.3V   | ESP32, logic            | Buck from 48V                 |
+-----------------+--------------+-------------------------+-------------------------------+
| Ring AC         | 90V AC, 20Hz | Ringer circuit          | Ring gen. from 48V            |
+-----------------+--------------+-------------------------+-------------------------------+

.. note::

   **Illuminated Dial Power: Separate 9V AC Supply**

   The 9V AC required for the phone's illuminated dial is not derived from the main power system. Instead, a separate 9V AC wall transformer is used, with its output fed directly to the black and yellow wires of the phone. This mirrors the original Bell System approach, where illumination was powered independently from the telephone line circuitry.


Component Notes
---------------

- **Buck converters:** Compact DC-DC modules (e.g., LM2596, MP1584) are recommended. Available as ready-to-use boards.
- **Inverting DC-DC:** Use telecom-grade inverting modules or custom flyback circuits to generate -48V from +48V.
- **Ring generator:** Options include:
  
  - Off-the-shelf telecom ring generator modules
  - Microcontroller-controlled boost + H-bridge (sine wave oscillator)
  - Classic 555 timer + transformer circuit for 90V AC


Design Considerations
---------------------

- The SLIC’s -48V is used *only* for line signaling on tip/ring, **not for chip logic**.
- All low-voltage logic (ESP32, digital control) shares a common ground with the SLIC and power supply, ensuring safe logic-level interfacing.
- The SLIC chip safely handles the interface between high-voltage line loop signals and your low-voltage control logic. Its output pins for status (such as off-hook detect or ring sense) are referenced to the same ground as your ESP32, so **no additional optocoupler isolation is required** between the SLIC and your microcontroller.
- The ring generator and DC-DC converters must be sized to meet the maximum expected load (60W should be ample for most single-line systems).
- For prototyping, use standard DC-DC modules; for production, design custom PCB layouts for compact integration.


.. note::

   **Why Avoid the Telco's "Flip-the-Ground" -48V For Line Loop**

   Classic telephone systems often created -48V for the line loop by tying the positive terminal of the 48V supply to system ground,
   making the negative terminal act as “-48V.” While simple and authentic, this approach “floats” the project ground 48V above earth ground.

   For this Ma Bell Gateway implementation, we use an inverting DC-DC converter to generate a true -48V relative to ground.
   This ensures all project circuits—including the SLIC, ESP32, and logic—reference true earth ground, keeping development and testing safe.

   If you use the classic telco trick and connect any test gear (oscilloscope, logic analyzer, USB device) referenced to earth ground,
   you risk creating a dangerous short circuit and damaging equipment. The inverting DC-DC approach keeps all bench measurements
   and expansion safe and reliable.

