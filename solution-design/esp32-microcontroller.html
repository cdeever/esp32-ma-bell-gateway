

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <meta property="article:modified_time" content="2025-12-27T01:04:28+00:00" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ESP32 Microcontroller &mdash; ESP32 Ma Bell Gateway 1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=edc13519" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=f2a433a1"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Circuit Design" href="circuit/index.html" />
    <link rel="prev" title="Solution Design" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            ESP32 Ma Bell Gateway
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../standards.html">Telephone Service Standards</a></li>
<li class="toctree-l1"><a class="reference internal" href="../historical-perspective.html">The Bell System Blueprint</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Solution Design</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">ESP32 Microcontroller</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#bluetooth-classic-vs-ble">Bluetooth Classic vs BLE</a></li>
<li class="toctree-l3"><a class="reference internal" href="#simultaneous-wi-fi-bluetooth">Simultaneous Wi-Fi + Bluetooth</a></li>
<li class="toctree-l3"><a class="reference internal" href="#audio-output-architecture">Audio Output Architecture</a></li>
<li class="toctree-l3"><a class="reference internal" href="#audio-input-architecture">Audio Input Architecture</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="circuit/index.html">Circuit Design</a></li>
<li class="toctree-l2"><a class="reference internal" href="software/index.html">Firmware Design</a></li>
<li class="toctree-l2"><a class="reference internal" href="enclosure/index.html">Enclosure Design</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../implementation/index.html">Implementation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage.html">User Guide</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">ESP32 Ma Bell Gateway</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Solution Design</a></li>
      <li class="breadcrumb-item active">ESP32 Microcontroller</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/solution-design/esp32-microcontroller.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="esp32-microcontroller">
<h1>ESP32 Microcontroller<a class="headerlink" href="#esp32-microcontroller" title="Link to this heading"></a></h1>
<a class="reference internal image-reference" href="../_images/esp32-wrover-ie.png"><img alt="ESP32-WROVER-IE Module" class="align-center" src="../_images/esp32-wrover-ie.png" style="width: 300px;" />
</a>
<p>Selecting the right ESP32 variant can be surprisingly tricky. There are dozens of versions—ESP32-C2, ESP32-S3, ESP32-WROVER, WROOM-32, and more—each with its own trade-offs in price, peripherals, core count, wireless support, and package size. After researching compatibility, availability, and feature sets, the <strong>ESP32-WROVER-IE</strong> was chosen for this project.</p>
<p>This module strikes an ideal balance for the Ma Bell Gateway:</p>
<ul class="simple">
<li><p>✅ <strong>Dual-core processor (Xtensa LX6 &#64; up to 240 MHz)</strong> – The ESP32 includes two powerful cores. <strong>Core 0</strong> is generally reserved for system-level tasks such as Wi-Fi and Bluetooth stacks, while <strong>Core 1</strong> runs the user application logic (e.g. GPIO handling, tone generation, state machine transitions). This separation is key for real-time responsiveness.</p></li>
<li><p>✅ <strong>Built-in Wi-Fi and Bluetooth Classic</strong> – Both are essential. Wi-Fi is used to serve a real-time web-based status page, and Bluetooth Classic enables call connectivity via the Hands-Free Profile (HFP).</p></li>
<li><p>✅ <strong>PSRAM (typically 4MB)</strong> – The WROVER series includes external pseudo-static RAM, which can be used for audio buffering, logging, or memory-intensive tasks. While not mandatory for this project, it provides headroom for future expansion.</p></li>
<li><p>✅ <strong>FreeRTOS included</strong> – The ESP-IDF framework includes <strong>FreeRTOS</strong> as its built-in real-time operating system and exposes a rich API for multitasking, timers, and inter-task communication. The Ma Bell Gateway uses FreeRTOS to juggle Bluetooth events, off-hook signaling, tone generation, and status updates — all without blocking or missing real-time events.</p></li>
<li><p>✅ <strong>External antenna connector</strong> – The “IE” version includes a u.FL connector for an external antenna, ensuring strong signal coverage throughout the home.</p></li>
<li><p>✅ <strong>Flexible audio I/O support</strong> – The ESP32 supports multiple options for generating and capturing audio signals. These include I2S for high-quality digital audio, built-in DACs for simple tones, ADC input for analog microphones, and optional support for external audio codecs. This flexibility allows the Ma Bell Gateway to mix modern Bluetooth voice with vintage analog signaling.</p></li>
</ul>
<section id="bluetooth-classic-vs-ble">
<h2>Bluetooth Classic vs BLE<a class="headerlink" href="#bluetooth-classic-vs-ble" title="Link to this heading"></a></h2>
<p>Although many ESP32 variants support <strong>Bluetooth Low Energy (BLE)</strong>, this project requires <strong>Bluetooth Classic</strong> due to its support for audio via the <strong>Hands-Free Profile (HFP)</strong>. BLE is optimized for short, energy-efficient data bursts (e.g. sensors, beacons), but it does not support voice or audio streaming. For this reason, only ESP32 modules that include Bluetooth Classic were considered.</p>
</section>
<section id="simultaneous-wi-fi-bluetooth">
<h2>Simultaneous Wi-Fi + Bluetooth<a class="headerlink" href="#simultaneous-wi-fi-bluetooth" title="Link to this heading"></a></h2>
<p>While Wi-Fi and Bluetooth share the same radio hardware, the ESP32 manages coexistence through fast time-sharing and protocol scheduling. With proper configuration:</p>
<ul class="simple">
<li><p>Wi-Fi can serve the internal status page and support future OTA updates.</p></li>
<li><p>Bluetooth Classic can maintain a call session with a mobile phone.</p></li>
<li><p>System tasks and phone logic remain responsive, even during heavy traffic.</p></li>
</ul>
<p>The ability to reliably run both wireless stacks alongside real-time GPIO handling was a key reason the WROVER-IE was selected.</p>
</section>
<section id="audio-output-architecture">
<h2>Audio Output Architecture<a class="headerlink" href="#audio-output-architecture" title="Link to this heading"></a></h2>
<p>The Ma Bell Gateway uses an <strong>external DAC connected via I2S</strong> for all audio output, including tones and Bluetooth-transmitted voice. This design decision provides several key advantages:</p>
<ul class="simple">
<li><p><strong>High Audio Quality:</strong> 16-bit+ resolution ensures clear voice transmission and high-fidelity tone generation</p></li>
<li><p><strong>Flexible Output:</strong> Single audio path supports both tone generation and voice playback, with hardware managing source switching</p></li>
<li><p><strong>Hardware-Configured Operation:</strong> Pin-strapping configuration eliminates complex software initialization and reduces potential software bugs</p></li>
<li><p><strong>Production-Ready Quality:</strong> Professional telephony audio suitable for commercial deployment</p></li>
</ul>
<p>Audio output is routed from the external DAC to the telephone earpiece via the SLIC line interface, with proper impedance matching and AC coupling to ensure compatibility with standard telephone handsets.</p>
<p><strong>Alternative Approaches Considered:</strong></p>
<ul class="simple">
<li><p><em>ESP32 Built-in DAC (GPIO25/26):</em> 8-bit resolution insufficient for high-quality voice transmission; suitable only for prototyping and early development testing</p></li>
<li><p><em>PWM Audio (LEDC):</em> Square-wave generation adequate for simple tones but lacks fidelity for voice and introduces switching noise incompatible with telephony quality standards</p></li>
</ul>
</section>
<section id="audio-input-architecture">
<h2>Audio Input Architecture<a class="headerlink" href="#audio-input-architecture" title="Link to this heading"></a></h2>
<p>The Ma Bell Gateway uses an <strong>external ADC connected via I2S</strong> for capturing microphone audio from the telephone handset. This architectural decision enables high-quality voice transmission over Bluetooth with several advantages:</p>
<ul class="simple">
<li><p><strong>Clear Voice Capture:</strong> High signal-to-noise ratio and low distortion ensure intelligible voice transmission for Bluetooth HFP calls</p></li>
<li><p><strong>Hardware-Configured Operation:</strong> Pin-strapping configuration simplifies firmware and eliminates codec initialization complexity</p></li>
<li><p><strong>Digital Interface Noise Immunity:</strong> I2S digital interface reduces susceptibility to analog noise and ground loops common in telephony circuits</p></li>
<li><p><strong>Legacy Phone Microphone Compatibility:</strong> External ADC allows proper gain staging and filtering for vintage telephone handset microphones</p></li>
</ul>
<p>The audio input path interfaces with the Bluetooth HFP stack to transmit voice from the telephone handset to the paired mobile device. Circuit design includes impedance matching, DC blocking, and AC coupling to ensure clean audio capture from the SLIC’s transmit path.</p>
<p><strong>Alternative Approaches Considered:</strong></p>
<ul class="simple">
<li><p><em>ESP32 Built-in ADC (GPIO36-39):</em> Designed for sensor readings, not continuous audio sampling; insufficient sample rate and quality for telephony applications</p></li>
<li><p><em>I2S Digital Microphone:</em> Would require replacing the telephone handset’s microphone entirely; not applicable to the Ma Bell Gateway’s use case of preserving the vintage phone experience</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Solution Design" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="circuit/index.html" class="btn btn-neutral float-right" title="Circuit Design" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Chris Deever.
      <span class="lastupdated">Last updated on Dec 27, 2025.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>